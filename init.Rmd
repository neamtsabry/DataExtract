---
title: "init"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ipumsr")
library(ipumsr)
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
```

Bringing in data with ipumsr package

```{r}
# Note that you can pass in the loaded DDI into the `read_ipums_micro()`
usa_ddi <- read_ipums_ddi("usa_00002.xml")
usa_data <- read_ipums_micro(usa_ddi, verbose = FALSE)

#Finding the variables that have a label
usa_data %>%
  select_if(is.labelled)

# Convert the labels to factors (and drop the unused levels)
usa_data2 <- usa_data %>%
  mutate(sex_factor = droplevels(as_factor(SEX)),
         marital_factor=droplevels(as_factor(MARST)),
         newchild_factor=droplevels(as_factor(FERTYR)),
         race_factor= droplevels(as_factor(RACE)),
         hispan_factor= droplevels(as_factor(HISPAN)),
         educ_factor= droplevels(as_factor(EDUC)),
         hinsur_factor= droplevels(as_factor(HCOVANY)),
         degfield_factor= droplevels(as_factor(DEGFIELD)),
         empstat_factor= droplevels(as_factor(EMPSTAT)),
         occ_factor= droplevels(as_factor(OCC)),
         ind_factor= droplevels(as_factor(IND)),
         diffmob_factor=droplevels(as_factor(DIFFMOB)),
         diffcare_factor=droplevels(as_factor(DIFFCARE)),
         vetstat_factor=droplevels(as_factor(VETSTAT)),
         pwstate_factor=droplevels(as_factor(PWSTATE2)),
         tranwork_factor=droplevels(as_factor(TRANWORK))
  )
```

Make an indicator variable of whether someone is employed or not from empstat_factor. A reminder of the code from where you’ve done this before:

```{r}
usa_data2<-usa_data2 %>%
  mutate(empstat_factor=if_else(empstat_factor=="Employed","Employed", "Unemployed"))
```

Recode newchild_factor so that it is a binary variable: yes vs. no.

```{r}
usa_data2<-usa_data2 %>%
  mutate(newchild_factor=if_else(newchild_factor=="Yes","Yes","No"))
```

Create a binary variable of whether someone was in a STEM field or not from degfield_factor.

```{r}
usa_data2<-usa_data2 %>%
  mutate(degfield_factor=if_else(degfield_factor %in% c("Environment and Natural Resources", "Computer and Information Sciences", "Engineering", "Biology and Life Sciences", "Mathematics and Statistics", "Physical Sciences"),"STEM", "Not STEM"))
```

Filter only the observations that are currently employed. Remember the filter function that we’ve seen before.

```{r}
usa_data2 <- usa_data2 %>%
  filter(empstat_factor=="Employed")
```

Keep only the variables that you will need for the analysis (also keep the PERNUM and SERIAL ID variables that help keep the individual and household observations straight.). Read ahead to the Analysis section for the scope of what you want to save here.

```{r}
usa_data2 <-usa_data2 %>%
  select(PERNUM,SERIAL,sex_factor,AGE,race_factor,tranwork_factor,TRANTIME)
```

Use the str() function to have R report the structure of the data to you.
```{r}
str(usa_data2)
```

Use favstats and tally functions from the mosaic package to look at each of the variables you have included in your data extract.

```{r}
library(mosaic)
favstats(~AGE, data=usa_data2)
favstats(~TRANTIME, data=usa_data2)
tally(~sex_factor, data=usa_data2)
tally(~race_factor, data=usa_data2)
tally(~tranwork_factor, data=usa_data2)
```

Try another approach - use the skimr package

```{r}
# install.packages("skimr")
library(skimr)
skim(usa_data2)
```

Evaluate each variable. Are the distributions what you would expect? Are there unusual values?

```{r}
ggplot(usa_data2, aes(x = AGE, fill = AGE)) + geom_bar()
```
```{r}
ggplot(usa_data2, aes(x = AGE, fill = AGE)) + geom_bar()
ggplot(usa_data2, aes(x = TRANTIME, fill = TRANTIME)) + geom_bar()
ggplot(usa_data2, aes(x = sex_factor, fill = sex_factor)) + geom_bar()
ggplot(usa_data2, aes(x = race_factor, fill = race_factor)) + geom_bar()
ggplot(usa_data2, aes(x = tranwork_factor, fill = tranwork_factor)) + geom_bar()
```

Most of the histograms of all the variables are right skewed. The category white in the race_factor variable and the category Auto, truck and Van in the transwork_factor variable are disproportionately bigger than to the other categories.

Create and interpret a scatterplot of you main explanatory and response variables: age and travel time. For Unusual Observations, now clarify potential leverage/influence/outliers.

```{r}
ggplot(usa_data2,aes(x=AGE, y=TRANTIME)) +
    geom_point() +           # Plot the scatterplot
    geom_smooth(method=lm,   # Add linear regression line
                se=FALSE)

agTimeMd <- lm(TRANTIME~AGE, data=usa_data2)

plot(agTimeMd, which=5)
```

## Exercise 14 

*Test whether the association between age and travel time (adjusted for other covariates as in the model above) varies by race race_factor. Save this model as m2*

```{r}
m2 <- lm(TRANTIME~AGE+race_factor, data=usa_data2)

summary(m2)
```

## Exercise 15 

*Interpret the coefficient for age in a sentence.*

The coefficient for Age (0.02687): for every additional year of age, travel time increases on average by 0.02687 adjusting for the race_factor.

## Exercise 16


